---

- name: add {{ weewx_user }} user
  user:
    name: "{{ weewx_user }}"
    shell: /bin/bash
    state: present

- name: download weewx binary
  get_url:
    url: http://weewx.com/downloads/weewx-3.7.1.tar.gz
    dest: /tmp
    mode: 0777

- name: expand archive
  unarchive:
    src: /tmp/weewx-3.7.1.tar.gz
    dest: /opt
    remote_src: True

- name: build weewx binaries
  command: ./setup.py build
  args:
    chdir: /opt/weewx-3.7.1

- name: create/overwrite config file from template
  template:
    src: weewx.conf.j2
    dest: /home/{{ weewx_user }}
    owner: root
    mode: 0664
